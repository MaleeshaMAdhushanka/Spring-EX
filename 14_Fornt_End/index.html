<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer manager</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Customer Management</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Item.html">Items</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="placeorder.html">Place Order</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container">
    <h1 class="mt-5">Customer Manage</h1>
    <div class="row">
        <div class="col-md-6">
            <form id="customerForm" class="mt-4">
                <div class="form-group">
                    <label for="customerId">ID</label>
                    <input type="text" class="form-control" id="customerId" placeholder="Enter ID">
                </div>
                <div class="form-group">
                    <label for="customerName">Name</label>
                    <input type="text" class="form-control" id="customerName" placeholder="Enter Name">
                </div>
                <div class="form-group">
                    <label for="customerAddress">Address</label>
                    <input type="text" class="form-control" id="customerAddress" placeholder="Enter Address">
                </div>
                <div class="form-group">
                    <label for="customerAge">Age</label>
                    <input type="number" class="form-control" id="customerAge" placeholder="Enter Age">
                </div>
                <button type="button" class="btn btn-primary" onclick="saveCustomer()">Save</button>
                <button type="button" class="btn btn-warning" onclick="updateCustomer()">Update</button>
                <button type="button" class="btn btn-danger" onclick="deleteCustomer()">Delete</button>
            </form>
        </div>
        <div class="col-md-6">
            <table class="table table-striped mt-4">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Age</th>
                </tr>
                </thead>
                <tbody id="customerTableBody">
                <!-- Customer rows will be added here dynamically -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    function saveCustomer() {

        const  customer = {
           id: $('#customerId').val(),
           name: $('#customerName').val(),
           address:$('#customerAddress').val(),
           age : $('#customerAge').val(),


      };
        /*
        JSON stands for JavaScript Object Notation

        JSON is a text format for storing and transporting data

         JSON is "self-describing" and easy to understand
         */
        $.ajax({
            url: 'http://localhost:8080/api/v1/customer/save',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(customer),
            success: function (response) {
                Swal.fire({
                   title: "Success!",
                   text: "Customer Saved successfully",
                   icon: "success",
                   confirmButtonText: "Ok"
                });
                clearFields();
                refreshTable()
            },
            error: function (error) {
                Swal.fire({
                    title:"Error!",
                    text: "Failed to save the customer",
                    icon: "error",
                    confirmButtonText: "Ok",
                    conformButtonColor: "#d33"
                });
            }
        });

    }

    function updateCustomer() {

    }

    function deleteCustomer() {

    }
    function refreshTable() {
        $.ajax({
           url: 'http://localhost:8080/api/v1/customer/getAll',
           type: 'GET',
            success: function (response) {
                if (Array.isArray(response)){
                  const customers = response;
                   const tableBody = $('#customerTableBody');
                   tableBody.empty();

                   customers.forEach(customer => {
                    const row =  `<tr onclick="loadCustomer('${customer.id}', '${customer.name}', '${customer.address}', '${customer.age}')">
                        <td>${customer.id}</td>
                        <td>${customer.name}</td>
                        <td>${customer.address}</td>
                        <td>${customer.age}</td>
                     </tr>`;
                    tableBody.append(row);
                   });
                   //show sucess alert
                    Swal.fire({
                       title: "Success!",
                       text: "Customer list loaded successfully",
                        icon: "success",
                        timer: 1500,
                        showConfirmButton: false
                    });
                } else {
                    console.error('Invalid response format..', response);
                    Swal.fire({
                       title: "Warning!",
                       text: "Received an unexpected response from ",
                        icon: "warning",
                        confirmButtonText: "Ok",
                        confirmButtonColor: "#f39c12"
                    });
                }
            },
            error: function (error) {
                console.error('Error loading customers:', error);
                Swal.fire({
                    title: "Error!",
                    text: "Failed to load the customer list. Please try again.",
                    icon: "error",
                    confirmButtonText: "Ok",
                    confirmButtonColor: "#d33"
                });
            }

        });

    }
    function clearFields() {
      $('#customerId').val('');
      $('#customerName').val('');
      $('#customerAddress').val('');
      $('#customerAge').val('');
    }
    function loadCustomer(id, name, address, age) {
        $('#customerId').val(id);
        $('#customerName').val(name);
        $('#customerAddress').val(address);
        $('#customerAge').val(age);
    }

    $(document).ready(function () {
        refreshTable();
    });


</script>

</body>
</html>